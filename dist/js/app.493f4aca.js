(function(){"use strict";var e={9686:function(e,t,o){var n=o(9963),s=o(6252);const l={id:"app"},a=(0,s._)("h1",null,"Перечень важных дел",-1),i={"aria-labelledby":"list-summary",class:"stack-large"};function c(e,t,o,c,r,d){const u=(0,s.up)("ConnectForm"),p=(0,s.up)("ToDoForm"),h=(0,s.up)("ToDoItem");return(0,s.wg)(),(0,s.iD)("div",l,[(0,s.wy)((0,s.Wm)(u,{onDbConnected:d.onConnect},null,8,["onDbConnected"]),[[n.F8,r.isConnectFormVisible]]),(0,s.wy)((0,s._)("div",null,[a,(0,s.Wm)(p,{onAddItem:d.onAdd,onDeleteAll:d.onClear,host:r.host,session_key:r.session_key,ToDoItems:r.ToDoItems},{default:(0,s.w5)((()=>[(0,s.Uk)("> ")])),_:1},8,["onAddItem","onDeleteAll","host","session_key","ToDoItems"]),(0,s._)("ul",i,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(r.ToDoItems,(e=>((0,s.wg)(),(0,s.iD)("li",{key:e.id},[(0,s.Wm)(h,{itemData:e,host:r.host,session_key:r.session_key},null,8,["itemData","host","session_key"])])))),128))])],512),[[n.F8,!r.isConnectFormVisible]])])}o(7658);var r=o(3577);const d={class:"custom-checkbox"},u=["id","checked"],p=["for"];function h(e,t,o,n,l,a){return(0,s.wg)(),(0,s.iD)("div",d,[(0,s._)("input",{type:"checkbox",id:o.itemData.id,checked:o.itemData.done,onClick:t[0]||(t[0]=e=>a.doneTodo(o.itemData.id)),class:"checkbox"},null,8,u),(0,s._)("label",{for:o.itemData.id,class:"checkbox-label"},(0,r.zw)(o.itemData.label),9,p)])}var m=o(6154),b={props:{itemData:{required:!0,type:Object},host:String,session_key:String},methods:{async doneTodo(e){let t=this;try{console.log("doneTodo");let n=!1;n=!t.itemData.done,console.log("axios write done:"+n);let s="в работе";!0===n&&(s="выполнено");try{const o={headers:{"X-APL-SessionKey":t.session_key}};let l="http://"+t.host+"/rest/save",a={format:"apl_json_1",dictionary:"apl_pss_a",instances:[{id:e,type:"apl_alert",attributes:{state:s}}]};console.log("data:"),console.log(a),m.Z.post(l,a,o).then((function(e){console.log("save date response: ",e),t.itemData.done=n})).catch((function(e){console.log(e)}))}catch(o){console.error(o)}}catch(o){console.error(o)}}},data(){return{}}},_=o(3744);const f=(0,_.Z)(b,[["render",h],["__scopeId","data-v-3b5a1970"]]);var g=f;const y=(0,s._)("h1",null,"Соединение с БД",-1),v=(0,s._)("h2",{class:"label-wrapper"},[(0,s._)("label",{for:"connect-input-host",class:"label__lg"}," Адрес сервера ")],-1),D=["value"],w=(0,s._)("h2",{class:"label-wrapper"},[(0,s._)("label",{for:"connect-input-username",class:"label__lg"}," Пользователь ")],-1),k=(0,s._)("h2",{class:"label-wrapper"},[(0,s._)("label",{for:"connect-input-password",class:"label__lg"}," Пароль ")],-1);function C(e,t,o,l,a,i){return(0,s.wg)(),(0,s.iD)("form",{onSubmit:t[6]||(t[6]=(0,n.iM)((()=>{}),["prevent"]))},[y,v,(0,s.wy)((0,s._)("input",{type:"text",id:"connect-input-host",name:"connect-db-host",autocomplete:"off","onUpdate:modelValue":t[0]||(t[0]=e=>a.host=e),class:"input__lg"},null,512),[[n.nr,a.host,void 0,{lazy:!0,trim:!0}]]),(0,s.wy)((0,s._)("select",{id:"connect-dbname","onUpdate:modelValue":t[1]||(t[1]=e=>a.selected_db_name=e),class:"input__lg"},[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(a.dbnames,(e=>((0,s.wg)(),(0,s.iD)("option",{value:e.value,key:e},(0,r.zw)(e.value),9,D)))),128))],512),[[n.bM,a.selected_db_name]]),(0,s._)("button",{onClick:t[2]||(t[2]=(...e)=>i.updateDbList&&i.updateDbList(...e)),class:"btn__primary btn__lg"},"Обновить список БД"),w,(0,s.wy)((0,s._)("input",{type:"text",id:"connect-input-username",name:"connect-db-username",autocomplete:"off","onUpdate:modelValue":t[3]||(t[3]=e=>a.username=e),class:"input__lg"},null,512),[[n.nr,a.username,void 0,{lazy:!0,trim:!0}]]),k,(0,s.wy)((0,s._)("input",{type:"text",id:"connect-input-password",name:"connect-db-password",autocomplete:"off","onUpdate:modelValue":t[4]||(t[4]=e=>a.password=e),class:"input__lg"},null,512),[[n.nr,a.password,void 0,{lazy:!0,trim:!0}]]),(0,s._)("button",{type:"submit",class:"btn btn__primary btn__lg",onClick:t[5]||(t[5]=(...e)=>i.submitForm&&i.submitForm(...e))},"Соединение")],32)}var A=o(2262),T={async mounted(){console.log("connect form created"),this.updateDbList()},methods:{updateDbList(e){console.log("updateDbList called"),this.dbnames=[];let t="http://"+this.host+"/rest/dblist",o=this;m.Z.get(t).then((function(e){console.log("dblist response.data: ",e.data);for(const t of e.data.dblist)o.dblistCnt=o.dbnames.push({value:t});console.log("self.dbnames:"),console.log(o.dbnames),console.log("self.dbnames cnt:",o.dblistCnt),o.dblistCnt>0&&(o.selected_db_name=o.dbnames[0].value)})).catch((function(e){console.log(e)})),e&&e.preventDefault()},async doConnect(){let e="",t=this,o="http://"+this.host+"/rest/connect/user="+this.username;""!=this.password&&void 0!=this.password&&(o+="&pass="+this.password),o+="&db="+this.selected_db_name,console.log("connect query:"+o),m.Z.get(o).then((function(o){console.log("response.data.session_key: "+o.data.session_key),e=o.data.session_key,t.$emit("db-connected",e,t.host)})).catch((function(e){console.log(e)}))},async submitForm(){if(""===this.username)return;let e="http://"+this.host+"/rest/disconnect";console.log("queryDisconnect:"+e);let t=this;m.Z.get(e).then((function(){console.log("disconnected from "+this.host),t.doConnect()})).catch((function(e){console.log(e),t.doConnect()}))}},data(){return{host:"localhost:7239",username:"Administrator",password:"",selected_db_name:(0,A.iH)("< Соединение с БД не выбрано >"),dbnames:(0,A.iH)([{value:"< Соединение с БД не выбрано >"}])}}};const x=(0,_.Z)(T,[["render",C]]);var I=x;const F=(0,s._)("h2",{class:"label-wrapper"},[(0,s._)("label",{for:"new-todo-input",class:"label__lg"}," Что требуется сделать? ")],-1);function S(e,t,o,l,a,i){return(0,s.wg)(),(0,s.iD)("form",{onSubmit:t[3]||(t[3]=(0,n.iM)(((...t)=>e.onSubmit&&e.onSubmit(...t)),["prevent"]))},[F,(0,s.wy)((0,s._)("input",{type:"text",id:"new-todo-input",name:"new-todo",autocomplete:"off","onUpdate:modelValue":t[0]||(t[0]=e=>a.label=e),class:"input__lg"},null,512),[[n.nr,a.label,void 0,{lazy:!0,trim:!0}]]),(0,s._)("button",{type:"submit",class:"btn btn__primary btn__lg",onClick:t[1]||(t[1]=(...e)=>i.onAdd&&i.onAdd(...e))},"Добавить"),(0,s._)("button",{type:"submit",class:"btn btn__danger btn__lg",onClick:t[2]||(t[2]=(...e)=>i.onDeleteAll&&i.onDeleteAll(...e))},"Очистить список")],32)}var O={props:{host:String,session_key:String,ToDoItems:Array},methods:{async onAdd(e){if(""!==this.label){try{const e={headers:{"X-APL-SessionKey":this.session_key}};let t="http://"+this.host+"/rest/save",o={format:"apl_json_1",dictionary:"apl_pss_a",instances:[{index:1,type:"apl_alert",attributes:{alert_text:this.label}}]},n=this;m.Z.post(t,o,e).then((function(e){console.log("response.data.instances: ",e.data.instances);for(let t=0;t!=e.data.instances.length;t++){let o=e.data.instances[t];if(console.log("todoData:"),console.log(o),void 0!=o){const e=o.id;n.$emit("add-item",{id:e,label:n.label,done:!1}),n.label=""}}})).catch((function(e){console.log(e)}))}catch(e){console.error(e),self.label=""}e.preventDefault()}},async onDeleteAll(e){if(!confirm("Очистить список?"))return;console.log("onDeleteAll!");let t=this;try{const e={headers:{"X-APL-SessionKey":t.session_key}};let o="http://"+t.host+"/rest/",n="";if(t.ToDoItems.forEach((e=>{""!==n&&(n+=","),n+=String(e.id)})),""===n)return;o+=n,console.log("delete query:"+o),m.Z["delete"](o,e).then((function(){console.log("axios.delete success! "),t.$emit("delete-all")})).catch((function(e){console.log(e)}))}catch(e){console.error(e)}e.preventDefault()}},data(){return{label:""}}};const Z=(0,_.Z)(O,[["render",S]]);var j=Z,L={name:"app",components:{ToDoItem:g,ConnectForm:I,ToDoForm:j},data(){return{session_key:"",host:"",isConnectFormVisible:!0,ToDoItems:[]}},methods:{async updateTodoItemsFromDb(){try{const e={headers:{"X-APL-SessionKey":this.session_key}};let t="http://"+this.host+"/rest/load/t=e&ent=apl_alert&all_attrs=true",o=this;m.Z.get(t,e).then((function(e){if(console.log("response.data.instances: ",e.data.instances),e.data.instances)for(let t=0;t<e.data.instances.length;t++){let n=e.data.instances[t];if(void 0!==n){const e=n.id,t=n.attributes.alert_text;let s=!1;"выполнено"===n.attributes.state&&(s=!0),o.ToDoItems.push({id:e,label:t,done:s})}}})).catch((function(e){console.log(e)}))}catch(e){console.error(e)}},onConnect(e,t){console.log("App onConnect()!"),console.log("app got session_key:"+e),console.log("app got host:"+t),this.session_key=e,this.host=t,this.updateTodoItemsFromDb(),this.isConnectFormVisible=!1},onAdd(e){console.log("App onAdd()!"),this.ToDoItems.push(e)},onClear(){console.log("App onClear()!"),this.ToDoItems=[]}}};const V=(0,_.Z)(L,[["render",c]]);var z=V;const K=(0,n.ri)(z);K.mount("#app")}},t={};function o(n){var s=t[n];if(void 0!==s)return s.exports;var l=t[n]={exports:{}};return e[n](l,l.exports,o),l.exports}o.m=e,function(){var e=[];o.O=function(t,n,s,l){if(!n){var a=1/0;for(d=0;d<e.length;d++){n=e[d][0],s=e[d][1],l=e[d][2];for(var i=!0,c=0;c<n.length;c++)(!1&l||a>=l)&&Object.keys(o.O).every((function(e){return o.O[e](n[c])}))?n.splice(c--,1):(i=!1,l<a&&(a=l));if(i){e.splice(d--,1);var r=s();void 0!==r&&(t=r)}}return t}l=l||0;for(var d=e.length;d>0&&e[d-1][2]>l;d--)e[d]=e[d-1];e[d]=[n,s,l]}}(),function(){o.d=function(e,t){for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={143:0};o.O.j=function(t){return 0===e[t]};var t=function(t,n){var s,l,a=n[0],i=n[1],c=n[2],r=0;if(a.some((function(t){return 0!==e[t]}))){for(s in i)o.o(i,s)&&(o.m[s]=i[s]);if(c)var d=c(o)}for(t&&t(n);r<a.length;r++)l=a[r],o.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return o.O(d)},n=self["webpackChunkmoz_todo_vue"]=self["webpackChunkmoz_todo_vue"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=o.O(void 0,[998],(function(){return o(9686)}));n=o.O(n)})();
//# sourceMappingURL=app.493f4aca.js.map